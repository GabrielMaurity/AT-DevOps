name: Final Production Pipeline

on:
  push:
    branches: [ "main" ] # Regra 1: SÃ³ roda na main

jobs:
  # Job 1: Ambiente de Desenvolvimento
  deploy-dev:
    runs-on: ubuntu-latest
    env:
      TARGET_ENV: dev # Regra 2: VariÃ¡vel de ambiente especÃ­fica
    steps:
      - name: Deploy para Dev
        env:
          API_TOKEN: ${{ secrets.API_KEY }} # Regra 3: Uso de Secrets
        run: |
          echo "ðŸš€ Iniciando deploy no ambiente: $TARGET_ENV"
          if [ -n "$API_TOKEN" ]; then
            echo "ðŸ”‘ Credenciais verificadas com sucesso."
          fi
          echo "âœ… Deploy em DEV concluÃ­do."

  # Job 2: Ambiente de Staging (SÃ³ roda se Dev passar)
  deploy-staging:
    needs: deploy-dev # Cria dependÃªncia (sequencial)
    runs-on: ubuntu-latest
    env:
      TARGET_ENV: staging
    steps:
      - name: Deploy para Staging
        run: |
          echo "ðŸš§ Promovendo cÃ³digo para: $TARGET_ENV"
          echo "âœ… Deploy em STAGING concluÃ­do."

  # Job 3: Ambiente de ProduÃ§Ã£o (SÃ³ roda se Staging passar)
  deploy-prod:
    needs: deploy-staging
    runs-on: ubuntu-latest
    env:
      TARGET_ENV: prod
    steps:
      - name: Deploy para ProduÃ§Ã£o
        run: |
          echo "ðŸš¨ ATENÃ‡ÃƒO: Iniciando deploy crÃ­tico em: $TARGET_ENV"
          echo "ðŸš€ AplicaÃ§Ã£o estÃ¡ NO AR em PRODUÃ‡ÃƒO!"