name: Monitor and Debug Workflow

on:
  workflow_dispatch: # Permite rodar manualmente para testar f치cil
  push:
    branches: ["ci/setup"]

env:
  # Rubrica: Vari치veis via env
  GLOBAL_VAR: "Configura칞칚o Global"

jobs:
  build-and-artifact:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Criar Arquivo de Log
        run: echo "Log de build gerado em $(date)" > build.log

      # Rubrica: Utilizar action upload-artifact
      - name: Upload de Artefato
        uses: actions/upload-artifact@v4
        with:
          name: log-build
          path: build.log

  deploy-check:
    needs: build-and-artifact
    runs-on: ubuntu-latest
    # Rubrica: Configurar ambiente protegido
    environment:
      name: production
      url: https://producao.exemplo.com

    steps:
      # Rubrica: Validar vari치veis obrigat칩rias
      - name: Validar Variaveis
        run: |
          if [ -z "${{ secrets.API_KEY }}" ]; then
            echo "::error::API_KEY n칚o configurada!"
            exit 1
          fi

      # Rubrica: Vari치veis em diferentes n칤veis e ::warning::
      - name: Monitoramento
        env:
          STEP_VAR: "N칤vel de Step"
        run: |
          echo "Global: $GLOBAL_VAR"
          echo "Step: $STEP_VAR"
          echo "::warning::Este 칠 um aviso personalizado para diagn칩stico."

      # Rubrica: Job Summaries
      - name: Gerar Resumo
        run: |
          echo "### 游 Resumo do Deploy" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** Sucesso" >> $GITHUB_STEP_SUMMARY
          echo "- **Artefato:** Gerado e salvo" >> $GITHUB_STEP_SUMMARY
          echo "- **Avisos:** Verifique os logs de warning" >> $GITHUB_STEP_SUMMARY